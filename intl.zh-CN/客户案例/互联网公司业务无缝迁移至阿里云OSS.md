# 互联网公司业务无缝迁移至阿里云OSS {#concept_orz_jyc_3gb .concept}

本文介绍某互联网企业架设在某云计算服务上的业务无缝迁移至阿里云 OSS 的案例。

## 背景信息 {#section_ptv_4yc_3gb .section}

客户 A 为某互联网服务公司，主要业务架设于某云计算服务提供商 B 处，为其用户提供图片、视频等在线编辑服务。客户 A 存储在 B 处的历史数据约有1亿个文件，共320TB 左右大小，每天新增约20GB 数据，B 处的数据存储服务和 OSS 的访问带宽均为250MByte/s，业务所需带宽最高为50MByte/s。

现因公司发展需要，考虑将业务切换至 OSS 上。切换时需将原始数据及新增的数据迁移至 OSS，因历史数据较多，为保证公司业务正常进行，此次业务切换需做到如下要求：

-   迁移中，需保证业务的正常进行，不能影响其用户正常读取数据。
-   迁移完成后，需保证数据完整，业务可无缝切换。

## 迁移方案 {#section_s3z_51d_3gb .section}

根据客户需求及背景信息，制定了如下迁移方案：

1.  通过阿里云在线迁移服务将客户的存量数据从云服务迁移到 OSS，迁移完成前，客户业务不做变动。
2.  存量数据迁移完成后，通过 OSS 的镜像回源功能让用户可以访问到暂时未迁移至 OSS 的增量数据。
3.  客户将业务切换至 OSS。
4.  业务切换完成后，通过在线迁移服务将用户的增量数据也迁移至 OSS。
5.  数据全部迁移完成并检查无误后，删除源端数据。

## 步骤一：迁移存量数据 {#section_dpk_z5j_3gb .section}

1.  创建用于存储迁移数据的 OSS Bucket，详细步骤请参考[创建存储空间](../../../../intl.zh-CN/控制台用户指南/管理存储空间/创建存储空间.md#)。
2.  创建用于迁移的子账号 AccessKey：
    -   获取 B 存储服务子账号的 AccessKey：登录云服务控制台获取访问密钥（AccessKey）。
    -   获取阿里云 OSS子账号的 AccessKey：请参考[创建 RAM 子账号并授予相关权限](../../../../intl.zh-CN/百度云 BOS 迁移教程/准备工作.md#section_p11_xff_qfb)。
3.  创建数据地址并创建全量迁移任务。详细配置步骤请参见[在线迁移服务](https://help.aliyun.com/product/94157.html)对应教程的迁移实施文档。其中，迁移任务的**任务配置**如下:

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/88193/155736904136102_zh-CN.png)

    **性能调优**配置如下：

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/88193/155736904136097_zh-CN.png)

4.  迁移完成后，需通过[查看迁移报告](../../../../intl.zh-CN/百度云 BOS 迁移教程/后续操作.md#section_jxv_xty_pfb)，并对比源地址和目的地址的数据，确认数据已经迁移完成。

    **说明：** 若出现文件迁移失败的情况，请参考[迁移失败常见问题及解决方案](../../../../intl.zh-CN/常见问题/迁移失败常见原因及解决方案.md#)。


## 步骤二：配置镜像回源 {#section_dw2_jbk_3gb .section}

迁移存量数据用时约25天，数据迁移过程中，源站还在不断产生新的数据。为了不中断业务，做到业务无缝切换，还需要配置镜像回源功能。当用户请求的文件在 OSS 中没有找到时，OSS会自动到源站抓取对应文件保存到 OSS，并将内容直接返回给用户。

1.  登录 [OSS 管理控制台](https://oss.console.aliyun.com/)。
2.  在存储空间列表内，单击存放迁移数据的存储空间。
3.  单击**存储设置**，之后单击**镜像回源**区域的**设置**。
4.  单击**创建规则**，在弹出的**创建规则**对话框填写回源信息。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/88193/155736904136104_zh-CN.png)

    -   **回源类型**：选择**镜像**。
    -   **回源条件**：默认选择**HTTP 状态码 404**，根据需求选择是否配置**文件名前缀**。
    -   **回源地址**：填写云服务访问地址信息。
    -   更多参数设置请参考[设置回源规则](../../../../intl.zh-CN/控制台用户指南/管理存储空间/设置回源规则.md#)。
    **说明：** 镜像回源可以配置5条，5条规则同时生效。若有多个资源，可以配置多条镜像回源策略，通过设置不同的**文件名前缀**回源不同的数据。

5.  单击**确定**，完成配置。

## 步骤三：业务切换至 OSS {#section_z25_fqq_3gb .section}

客户在业务服务器上将数据读取的源地址切换至 OSS。

## 步骤四：迁移增量数据 {#section_xsv_jqq_3gb .section}

迁移存量数据期间，源端产生了约100000个，共500GB 左右大小的文件，还需要将这部分增量数据迁移到 OSS。

1.  根据步骤一的创建迁移任务重新创建一个增量迁移任务。其中，迁移任务的**任务配置**如下:

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/88193/155736904136098_zh-CN.png)

    **性能调优**配置如下：

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/88193/155736904136101_zh-CN.png)

2.  单击**创建**，开始执行迁移任务。
3.  迁移完成后，需通过[查看迁移报告](../../../../intl.zh-CN/百度云 BOS 迁移教程/后续操作.md#section_jxv_xty_pfb)，并对比源地址和目的地址的数据，确认数据已经迁移完成。

    **说明：** 若出现文件迁移失败的情况，请参考[迁移失败常见问题及解决方案](../../../../intl.zh-CN/常见问题/迁移失败常见原因及解决方案.md#)。


## 步骤五：删除源端数据 {#section_ffv_lcr_3gb .section}

所有数据迁移完成后，为防止源端继续产生存储费用，可通过生命周期管理，将 Object 生命周期设置为1天，1天后将删除所有数据。


# 计量项与计费项 {#concept_592780 .concept}

在线迁移功能暂时是不收取服务费用的，但是因迁移数据时涉及到API请求及数据的上传、下载，所以会产生一定的API请求及下载流量费用，本文主要介绍在线迁移服务产生的费用计算方法。

## 在线迁移过程说明 {#section_0yp_889_qg8 .section}

数据在线迁移服务会通过以下步骤完成数据迁移的工作：

1.  获取待迁移数据信息：此过程中，在线迁移服务会比对源和目的地址文件的size、ContentType及LastModify。若源文件较新，则迁移文件；若目的文件较新，则忽略该文件。
2.  迁移数据：此过程中，在线迁移服务会将源地址的数据迁移到目的地址中。
3.  校验数据：此过程中，在线迁移服务会将迁移后的数据和源地址中的数据进行对比，确认数据完整。
4.  生成迁移日志：此过程中，在线迁移服务会读取目的地址中被迁移的数据，生成迁移日志。

## API请求次数 {#section_wf2_tmv_u70 .section}

在线迁移任务在数据迁移前需要对源地址和目的地址的文件进行对比；迁移时将源文件下载后上传到目的地址；迁移完成后校验文件，会产生API请求。不同场景下，API请求次数不同。 针对单个文件，API请求次数如下：

**说明：** 

-   以下说明仅针对源端为第三方云商或阿里云对象存储OSS。阿里云文件存储NAS、HTTP/HTTPS、ECS数据迁移时，不涉及源端的API请求费用。
-   以下说明默认为迁移成功的状态，不涉及迁移失败时的API请求。

-   针对源地址中与目的地址不同名的文件
    -   对源端的操作
        -   迁移前对比数据需要两次请求：GetSize、GetLastModify
        -   迁移数据需要一次请求：GetObject
        -   迁移完成后校验数据需要两次请求：GetSize、GetMeta
    -   对目的端的操作
        -   迁移前对比数据需要一次请求：GetMeta
        -   迁移数据需要一次请求：PutObject

            **说明：** 若迁移的文件大于或等于150MB，则迁移数据时会将文件进行分片后再上传，单个分片大小为50MB，此时迁移数据的请求数根据迁移数据大小决定。例如，大小为150MB的文件会被分成三片上传，产生三次请求。

        -   迁移完成后校验数据需要两次请求：GetSize、GetMeta
        -   获取迁移日志需要两次请求：GetSize、GetMeta
-   针对源地址和目的地址的同名文件，当文件需要迁移至目的地址时
    -   对源端的操作
        -   迁移前对比数据需要三次请求：GetSize、GetLastModify、GetContentType
        -   迁移数据需要一次请求：GetObject
        -   迁移完成后校验数据需要两次请求：GetSize、GetMeta
    -   对目的端的操作
        -   迁移前对比数据需要两次请求：GetSize、GetContentType
        -   迁移数据需要一次请求：PutObject

            **说明：** 若迁移的文件大于或等于150MB，则迁移数据时会将文件进行分片后再上传，单个分片大小为50MB，此时迁移数据的请求数根据迁移数据大小决定。例如，大小为150MB的文件会被分成三片上传，产生三次请求。

        -   迁移任务完成后校验数据需要两次请求：GetSize、GetMeta
        -   获取迁移日志需要两次请求：GetSize、GetMeta
    -   针对源地址和目的地址的同名文件，当文件不需要迁移至目的地址时
        -   对源端的操作
            -   迁移前对比数据需要两次请求：GetSize、GetLastModify
            -   迁移任务完成后校验数据需要两次请求：GetSize、GetMeta
        -   对目的端的操作
            -   迁移前对比数据需要一次请求：GetMeta
            -   迁移任务完成后校验数据需要两次请求：GetSize、GetMeta
            -   获取迁移日志需要两次请求：GetSize、GetMeta

计算示例：某用户需要迁移1000个文件，单个文件大小均为150MB以下。其中有500个文件在目的地址中没有同名文件；300个同名文件，但目的端需要更新；200个同名文件，目的端不需要更新。共计产生API请求次数如下（示例视迁移任务正常完成，未产生迁移错误）：

-   源地址

    ``` {#codeblock_k9p_74r_4ts}
    500*5+300*6+200*4=5100
    ```

-   目的地址

    ``` {#codeblock_rps_7w4_gdx}
    500*6+300*7+200*5=6100
    ```


**说明：** API请求的实际费用以各云商定价为准，OSS的费用请参考[计量项和计费项](../../../../cn.zh-CN/计量计费/计量项和计费项.md#)。

## 下载与上传流量费用 {#section_ad2_e9a_apd .section}

数据迁移时，在线迁移服务会先将数据从源端下载，再将数据上传至OSS。这个过程会产生一定的流量费用，不同场景下的流量费用如下：

**说明：** 

-   以下说明仅针对源端为第三方云商或OSS。阿里云NAS、HTTP/HTTPS、ECS数据迁移时，不涉及源端的下载费用。
-   以下说明默认为迁移成功的状态，不涉及迁移失败时流量费用。

-   源端为第三方云商

    此时会在源端产生数据下载费用，产生的流量由数据的实际大小决定，由源地址所在云商收取。数据上传至OSS是不收取流量费用的。

-   源地址和目的地址均为OSS，且使用的阿里云内网进行数据迁移

    此时数据上传下载均在阿里云内网进行，不会产生流量费用。

-   源地址和目的地址均为OSS，且使用的公网进行数据迁移

    此时会在源端产生数据下载费用，产生的流量由数据的实际大小决定，由阿里云OSS收取。数据上传至OSS是不收取流量费用的。


